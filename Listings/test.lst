A51 MACRO ASSEMBLER  TEST                                                                 06/07/2025 09:16:11 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\test.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE test.a51 SET(SMALL) DEBUG PRINT(.\Listings\test.lst) OBJECT(.\Objects\t
                      est.obj) EP

LOC  OBJ            LINE     SOURCE

0000                   1                 ORG 0000H
0000 020038            2                 LJMP START
                       3     
0003                   4                 ORG 0003H
0003 020110            5                 LJMP INT0_ISR
                       6     
0006 53656C65          7     IPMSG:      DB "Select 3 DIGITS", 0
000A 63742033                
000E 20444947                
0012 49545300                
0016 444F4F52          8     TEXT_S:     DB "DOOR OPENED", 0
001A 204F5045                
001E 4E454400                
0022 57524F4E          9     TEXT_F:     DB "WRONG PASSWORD", 0
0026 47205041                
002A 5353574F                
002E 524400                  
0031 31323300         10     PASSW:      DB "123", 0     ; 正確密碼
0035                  11     USERIN:     DS 3              ; 用來儲存輸入字元（30H~34H）
  0096                12                     RS BIT 0x96     ; P2.6
  0097                13                 EN BIT 0x97     ; P2.7
  0094                14                 RW BIT 0x94     ; P2.4
                      15     
0038                  16     START:      
0038 D2B2             17                 SETB P3.2
003A D288             18                 SETB IT0
003C D2A8             19                 SETB EX0
003E D2AF             20                 SETB EA
0040 7C00             21                             MOV R4, #0
                      22     
0042                  23     MAIN_LOOP:
0042 11A6             24                 ACALL LCD_INIT
0044 900006           25                 MOV DPTR, #IPMSG
0047 11C0             26                 ACALL LCD_PRINT_LINE1   ; 顯示提示文字
0049 7830             27                 MOV R0, #30H        ; 輸入次數計數器
004B 7A30             28                 MOV R2, #'0'        ; 循環字元從 '0' 開始
004D 7D00             29                             MOV R5, #0
004F C225             30                             CLR 25H
                      31     
0051                  32     INPUT_LOOP:
0051 11D1             33                             ACALL SET_CURSOR_LINE2
0053 EA               34                             MOV A, R2
0054 11D6             35                             ACALL LDAT
0056 11FE             36                             ACALL DELAY_2S
0058 BD0004           37                             CJNE R5, #0, HANDLE_ISR
005B 11F0             38                             ACALL NEXT_CHAR_ROUTINE
005D 80F2             39                             SJMP INPUT_LOOP
                      40     ; -------------------------------
                      41     ; 中斷執行 儲存當前字元到 USERIN[i]
                      42     ; -------------------------------
005F                  43     HANDLE_ISR:
005F EC               44                             MOV A, R4
0060 2430             45                 ADD A, #30H
0062 F8               46                 MOV R0, A
0063 EA               47                 MOV A, R2
0064 F6               48                 MOV @R0, A
0065 0C               49                 INC R4
A51 MACRO ASSEMBLER  TEST                                                                 06/07/2025 09:16:11 PAGE     2

                      50     
0066 BC03D9           51                 CJNE R4, #3, MAIN_LOOP
                      52     
                      53                 ; == 剛儲存完全部，開始比對 ==
0069 1171             54                 ACALL CHECK_PASSWORD
006B 119C             55                 ACALL CLEAR_USERIN
006D 7C00             56                 MOV R4, #0
006F 80D1             57                             SJMP MAIN_LOOP
                      58     
                      59     ; -------------------------------
                      60     ; 密碼比對
                      61     ; -------------------------------
0071                  62     CHECK_PASSWORD:
0071 7B00             63                             MOV R3, #0
0073 900031           64                             MOV DPTR, #PASSW
                      65     
0076                  66     CHK_LOOP:
0076 EB               67                             MOV A, R3
0077 2430             68                             ADD A, #30H
0079 F8               69                             MOV R0, A
007A E6               70                             MOV A, @R0
007B F540             71                             MOV 40H, A
                      72     
007D EB               73                             MOV A, R3
007E 93               74                             MOVC A, @A+DPTR
007F B54010           75                             CJNE A, 40H, WRONG
                      76     
0082 0B               77                             INC R3
0083 BB03F0           78                             CJNE R3, #3, CHK_LOOP   ; 比對完 3 碼就跳出
0086 8000             79                             SJMP CORRECT
                      80     
0088                  81     CORRECT:
0088 11BB             82                             ACALL LCD_CLR
008A 900016           83                             MOV DPTR, #TEXT_S
008D 11C0             84                             ACALL LCD_PRINT_LINE1
008F 11FE             85                             ACALL DELAY_2S
0091 22               86                             RET
                      87     
0092                  88     WRONG:
0092 11BB             89                             ACALL LCD_CLR
0094 900022           90                             MOV DPTR, #TEXT_F
0097 11C0             91                             ACALL LCD_PRINT_LINE1
0099 11FE             92                             ACALL DELAY_2S
009B 22               93                             RET
009C                  94     CLEAR_USERIN:
009C 7905             95                 MOV R1, #5
009E 7830             96                 MOV R0, #30H
00A0                  97     CLR_LOOP:
00A0 7600             98                 MOV @R0, #0
00A2 08               99                 INC R0
00A3 D9FB            100                 DJNZ R1, CLR_LOOP
00A5 22              101                 RET
                     102     
                     103     ; -------------------------------
                     104     ; LCD 初始與控制
                     105     ; -------------------------------
00A6                 106     LCD_INIT:
00A6 7438            107                 MOV A, #38H
00A8 11E3            108                 ACALL LCMD
00AA 740C            109                 MOV A, #0CH
00AC 11E3            110                 ACALL LCMD
00AE 7406            111                 MOV A, #06H
00B0 11E3            112                 ACALL LCMD
00B2 7401            113                 MOV A, #01H
00B4 11E3            114                 ACALL LCMD
00B6 7402            115                 MOV A, #02H
A51 MACRO ASSEMBLER  TEST                                                                 06/07/2025 09:16:11 PAGE     3

00B8 11E3            116                 ACALL LCMD
00BA 22              117                 RET
                     118     
00BB                 119     LCD_CLR:
00BB 7401            120                 MOV A, #01H
00BD 11E3            121                 ACALL LCMD
00BF 22              122                 RET
                     123     
00C0                 124     LCD_PRINT_LINE1:
00C0 11CC            125                 ACALL SET_CURSOR_LINE1
00C2                 126     LCD_PRINT:
00C2 E4              127                 CLR A
00C3 93              128                 MOVC A, @A+DPTR
00C4 6005            129                 JZ DONE_PRINT
00C6 11D6            130                 ACALL LDAT
00C8 A3              131                 INC DPTR
00C9 80F7            132                 SJMP LCD_PRINT
00CB                 133     DONE_PRINT:
00CB 22              134                 RET
                     135     
00CC                 136     SET_CURSOR_LINE1:
00CC 7480            137                 MOV A, #80H
00CE 11E3            138                 ACALL LCMD
00D0 22              139                 RET
                     140     
00D1                 141     SET_CURSOR_LINE2:
00D1 74C0            142                 MOV A, #0C0H
00D3 11E3            143                 ACALL LCMD
00D5 22              144                 RET
                     145     
00D6                 146     LDAT:
00D6 F580            147                 MOV P0, A
00D8 D296            148                 SETB RS
00DA C294            149                 CLR RW
00DC D297            150                 SETB EN
00DE 3107            151                 ACALL DELAY
00E0 C297            152                 CLR EN
00E2 22              153                 RET
                     154     
00E3                 155     LCMD:
00E3 F580            156                 MOV P0, A
00E5 C296            157                 CLR RS
00E7 C294            158                 CLR RW
00E9 D297            159                 SETB EN
00EB 3107            160                 ACALL DELAY
00ED C297            161                 CLR EN
00EF 22              162                 RET
                     163     
                     164     ; -------------------------------
                     165     ; 下一個字元 '0'~'9','A'~'F' 循環
                     166     ; -------------------------------
00F0                 167     NEXT_CHAR_ROUTINE:
00F0 0A              168                 INC R2
00F1 BA3A04          169                 CJNE R2, #'9'+1, AF_CHECK  ; 跳到 AF_CHECK 檢查是否超過 'F'
00F4 7A41            170                 MOV R2, #'A'
00F6 8005            171                 SJMP DONE_NEXT
                     172     
00F8                 173     AF_CHECK:
00F8 BA4702          174                 CJNE R2, #'F'+1, DONE_NEXT ; 檢查是否超過 'F'
00FB 7A30            175                 MOV R2, #'0'              ; 若超過，回到 '0'
                     176     
00FD                 177     DONE_NEXT:
00FD 22              178                 RET
                     179     
                     180     ; -------------------------------
                     181     ; 延遲副程式
A51 MACRO ASSEMBLER  TEST                                                                 06/07/2025 09:16:11 PAGE     4

                     182     ; -------------------------------
00FE                 183     DELAY_2S:
00FE 3107            184                 ACALL DELAY
0100 3107            185                 ACALL DELAY
0102 3107            186                 ACALL DELAY
0104 3107            187                 ACALL DELAY
0106 22              188                 RET
                     189     
0107                 190     DELAY:
0107 7FFF            191                 MOV R7, #255
0109 7EFF            192     D1:         MOV R6, #255
010B DEFE            193     D2:         DJNZ R6, D2
010D DFFA            194                 DJNZ R7, D1
010F 22              195                 RET
                     196     
0110                 197     INT0_ISR:
0110 7D01            198                             MOV R5, #1
0112 D225            199                 SETB 25H 
0114 32              200                 RETI
                     201        END
A51 MACRO ASSEMBLER  TEST                                                                 06/07/2025 09:16:11 PAGE     5

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

AF_CHECK . . . . .  C ADDR   00F8H   A   
CHECK_PASSWORD . .  C ADDR   0071H   A   
CHK_LOOP . . . . .  C ADDR   0076H   A   
CLEAR_USERIN . . .  C ADDR   009CH   A   
CLR_LOOP . . . . .  C ADDR   00A0H   A   
CORRECT. . . . . .  C ADDR   0088H   A   
D1 . . . . . . . .  C ADDR   0109H   A   
D2 . . . . . . . .  C ADDR   010BH   A   
DELAY. . . . . . .  C ADDR   0107H   A   
DELAY_2S . . . . .  C ADDR   00FEH   A   
DONE_NEXT. . . . .  C ADDR   00FDH   A   
DONE_PRINT . . . .  C ADDR   00CBH   A   
EA . . . . . . . .  B ADDR   00A8H.7 A   
EN . . . . . . . .  B ADDR   0090H.7 A   
EX0. . . . . . . .  B ADDR   00A8H.0 A   
HANDLE_ISR . . . .  C ADDR   005FH   A   
INPUT_LOOP . . . .  C ADDR   0051H   A   
INT0_ISR . . . . .  C ADDR   0110H   A   
IPMSG. . . . . . .  C ADDR   0006H   A   
IT0. . . . . . . .  B ADDR   0088H.0 A   
LCD_CLR. . . . . .  C ADDR   00BBH   A   
LCD_INIT . . . . .  C ADDR   00A6H   A   
LCD_PRINT. . . . .  C ADDR   00C2H   A   
LCD_PRINT_LINE1. .  C ADDR   00C0H   A   
LCMD . . . . . . .  C ADDR   00E3H   A   
LDAT . . . . . . .  C ADDR   00D6H   A   
MAIN_LOOP. . . . .  C ADDR   0042H   A   
NEXT_CHAR_ROUTINE.  C ADDR   00F0H   A   
P0 . . . . . . . .  D ADDR   0080H   A   
P3 . . . . . . . .  D ADDR   00B0H   A   
PASSW. . . . . . .  C ADDR   0031H   A   
RS . . . . . . . .  B ADDR   0090H.6 A   
RW . . . . . . . .  B ADDR   0090H.4 A   
SET_CURSOR_LINE1 .  C ADDR   00CCH   A   
SET_CURSOR_LINE2 .  C ADDR   00D1H   A   
START. . . . . . .  C ADDR   0038H   A   
TEXT_F . . . . . .  C ADDR   0022H   A   
TEXT_S . . . . . .  C ADDR   0016H   A   
USERIN . . . . . .  C ADDR   0035H   A   
WRONG. . . . . . .  C ADDR   0092H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
