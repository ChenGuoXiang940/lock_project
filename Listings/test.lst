A51 MACRO ASSEMBLER  TEST                                                                 06/06/2025 15:01:07 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\test.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE test.a51 SET(SMALL) DEBUG PRINT(.\Listings\test.lst) OBJECT(.\Objects\t
                      est.obj) EP

LOC  OBJ            LINE     SOURCE

0000                   1                 ORG 0000H
  0096                 2                 RS BIT 0x96     ; P2.6
  0097                 3                 EN BIT 0x97     ; P2.7
  0094                 4                 RW BIT 0x94     ; P2.4
0000 D2B2              5        SETB P3.2
0002 D288              6        SETB IT0
0004 D2A8              7        SETB EX0
0006 D2AF              8        SETB EA
                       9     
0008 53656C65         10     IPMSG:      DB "Select 5 DIGITS", 0
000C 63742035                
0010 20444947                
0014 49545300                
0018 444F4F52         11     TEXT_S:     DB "DOOR OPENED", 0
001C 204F5045                
0020 4E454400                
0024 57524F4E         12     TEXT_F:     DB "WRONG PASSWORD", 0
0028 47205041                
002C 5353574F                
0030 524400                  
0033 31323334         13     PASSW:      DB "12345", 0     ; 正確密碼
0037 3500                    
0039                  14     USERIN:     DS 5              ; 用來儲存輸入字元（30H~34H）
                      15     
003E                  16     START:      
003E 8000             17                 SJMP MAIN_LOOP
                      18     
0040                  19     MAIN_LOOP:
0040 118F             20                 ACALL LCD_INIT
0042 900008           21                 MOV DPTR, #IPMSG
0045 11A9             22                 ACALL LCD_PRINT_LINE1   ; 顯示提示文字
0047 7830             23                 MOV R0, #30H        ; 輸入次數計數器
0049 7A30             24                 MOV R2, #'0'        ; 循環字元從 '0' 開始
004B 8000             25        SJMP INPUT_LOOP
                      26     
004D                  27     INPUT_LOOP:
004D 11BA             28         ACALL SET_CURSOR_LINE2
004F EA               29         MOV A, R2
0050 11BF             30         ACALL LDAT
0052 11E7             31         ACALL DELAY_2S
0054 11D9             32         ACALL NEXT_CHAR_ROUTINE
0056 E525             33         MOV A, 25H
0058 60F3             34         JZ INPUT_LOOP
                      35     
005A C225             36         CLR 25H
005C D288             37             SETB IT0
005E 1162             38         ACALL CHECK_PASSWORD
                      39             
0060 80DE             40         SJMP MAIN_LOOP
                      41     
                      42     ; -------------------------------
                      43     ; 密碼比對
                      44     ; -------------------------------
0062                  45     CHECK_PASSWORD:
0062 7B00             46         MOV R3, #0              ; 索引 i = 0
0064 900033           47         MOV DPTR, #PASSW        ; 指向密碼常數
                      48     
A51 MACRO ASSEMBLER  TEST                                                                 06/06/2025 15:01:07 PAGE     2

0067                  49     CHK_LOOP:
0067 EB               50         MOV A, R3
0068 2430             51         ADD A, #30H
006A F8               52         MOV R0, A
006B E6               53         MOV A, @R0              ; 取出使用者輸入 USERIN[i]
006C F540             54         MOV 40H, A              ; 存到 RAM 40H 暫存
                      55     
                      56         ; 取出對應密碼 PASSW[i]
006E EB               57         MOV A, R3
006F 93               58         MOVC A, @A+DPTR         ; 取 ROM 中密碼
0070 B54011           59         CJNE A, 40H, WRONG      ; 和使用者輸入比較
                      60     
0073 0B               61         INC R3
0074 BB05F0           62         CJNE R3, #5, CHK_LOOP
                      63     
0077 8000             64         SJMP CORRECT
                      65     
0079                  66     CORRECT:
0079 11A4             67                 ACALL LCD_CLR
007B 900018           68                 MOV DPTR, #TEXT_S
007E 11A9             69                 ACALL LCD_PRINT_LINE1
0080 11E7             70        ACALL DELAY_2S
0082 80BC             71                 SJMP MAIN_LOOP
                      72     
0084                  73     WRONG:
0084 11A4             74                 ACALL LCD_CLR
0086 900024           75                 MOV DPTR, #TEXT_F
0089 11A9             76                 ACALL LCD_PRINT_LINE1
008B 11E7             77                 ACALL DELAY_2S
008D 80B1             78                 SJMP MAIN_LOOP
                      79     
                      80     ; -------------------------------
                      81     ; LCD 初始與控制
                      82     ; -------------------------------
008F                  83     LCD_INIT:
008F 7438             84                 MOV A, #38H
0091 11CC             85                 ACALL LCMD
0093 740C             86                 MOV A, #0CH
0095 11CC             87                 ACALL LCMD
0097 7406             88                 MOV A, #06H
0099 11CC             89                 ACALL LCMD
009B 7401             90                 MOV A, #01H
009D 11CC             91                 ACALL LCMD
009F 7402             92                 MOV A, #02H
00A1 11CC             93                 ACALL LCMD
00A3 22               94                 RET
                      95     
00A4                  96     LCD_CLR:
00A4 7401             97                 MOV A, #01H
00A6 11CC             98                 ACALL LCMD
00A8 22               99                 RET
                     100     
00A9                 101     LCD_PRINT_LINE1:
00A9 11B5            102                 ACALL SET_CURSOR_LINE1
00AB                 103     LCD_PRINT:
00AB E4              104                 CLR A
00AC 93              105                 MOVC A, @A+DPTR
00AD 6005            106                 JZ DONE_PRINT
00AF 11BF            107                 ACALL LDAT
00B1 A3              108                 INC DPTR
00B2 80F7            109                 SJMP LCD_PRINT
00B4                 110     DONE_PRINT:
00B4 22              111                 RET
                     112     
00B5                 113     SET_CURSOR_LINE1:
00B5 7480            114                 MOV A, #80H
A51 MACRO ASSEMBLER  TEST                                                                 06/06/2025 15:01:07 PAGE     3

00B7 11CC            115                 ACALL LCMD
00B9 22              116                 RET
                     117     
00BA                 118     SET_CURSOR_LINE2:
00BA 74C0            119                 MOV A, #0C0H
00BC 11CC            120                 ACALL LCMD
00BE 22              121                 RET
                     122     
00BF                 123     LDAT:
00BF F580            124                 MOV P0, A
00C1 D296            125                 SETB RS
00C3 C294            126                 CLR RW
00C5 D297            127                 SETB EN
00C7 11F0            128                 ACALL DELAY
00C9 C297            129                 CLR EN
00CB 22              130                 RET
                     131     
00CC                 132     LCMD:
00CC F580            133                 MOV P0, A
00CE C296            134                 CLR RS
00D0 C294            135                 CLR RW
00D2 D297            136                 SETB EN
00D4 11F0            137                 ACALL DELAY
00D6 C297            138                 CLR EN
00D8 22              139                 RET
                     140     
                     141     ; -------------------------------
                     142     ; 下一個字元 '0'~'9','A'~'F' 循環
                     143     ; -------------------------------
00D9                 144     NEXT_CHAR_ROUTINE:
00D9 0A              145                 INC R2
00DA BA3A04          146                 CJNE R2, #'9'+1, AF_CHECK  ; 跳到 AF_CHECK 檢查是否超過 'F'
00DD 7A41            147                 MOV R2, #'A'
00DF 8005            148                 SJMP DONE_NEXT
                     149     
00E1                 150     AF_CHECK:
00E1 BA4702          151                 CJNE R2, #'F'+1, DONE_NEXT ; 檢查是否超過 'F'
00E4 7A30            152                 MOV R2, #'0'              ; 若超過，回到 '0'
                     153     
00E6                 154     DONE_NEXT:
00E6 22              155                 RET
                     156     
                     157     ; -------------------------------
                     158     ; 延遲副程式
                     159     ; -------------------------------
00E7                 160     DELAY_2S:
00E7 11F0            161                 ACALL DELAY
00E9 11F0            162                 ACALL DELAY
00EB 11F0            163                 ACALL DELAY
00ED 11F0            164                 ACALL DELAY
00EF 22              165                 RET
                     166     
00F0                 167     DELAY:
00F0 7FFF            168                 MOV R7, #255
00F2 7EFF            169     D1:         MOV R6, #255
00F4 DEFE            170     D2:         DJNZ R6, D2
00F6 DFFA            171                 DJNZ R7, D1
00F8 22              172                 RET
                     173     
00F9                 174     INT0_ISR:
00F9 D225            175                 SETB 25H 
00FB 014D            176                 AJMP INPUT_LOOP
                     177        END
A51 MACRO ASSEMBLER  TEST                                                                 06/06/2025 15:01:07 PAGE     4

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

AF_CHECK . . . . .  C ADDR   00E1H   A   
CHECK_PASSWORD . .  C ADDR   0062H   A   
CHK_LOOP . . . . .  C ADDR   0067H   A   
CORRECT. . . . . .  C ADDR   0079H   A   
D1 . . . . . . . .  C ADDR   00F2H   A   
D2 . . . . . . . .  C ADDR   00F4H   A   
DELAY. . . . . . .  C ADDR   00F0H   A   
DELAY_2S . . . . .  C ADDR   00E7H   A   
DONE_NEXT. . . . .  C ADDR   00E6H   A   
DONE_PRINT . . . .  C ADDR   00B4H   A   
EA . . . . . . . .  B ADDR   00A8H.7 A   
EN . . . . . . . .  B ADDR   0090H.7 A   
EX0. . . . . . . .  B ADDR   00A8H.0 A   
INPUT_LOOP . . . .  C ADDR   004DH   A   
INT0_ISR . . . . .  C ADDR   00F9H   A   
IPMSG. . . . . . .  C ADDR   0008H   A   
IT0. . . . . . . .  B ADDR   0088H.0 A   
LCD_CLR. . . . . .  C ADDR   00A4H   A   
LCD_INIT . . . . .  C ADDR   008FH   A   
LCD_PRINT. . . . .  C ADDR   00ABH   A   
LCD_PRINT_LINE1. .  C ADDR   00A9H   A   
LCMD . . . . . . .  C ADDR   00CCH   A   
LDAT . . . . . . .  C ADDR   00BFH   A   
MAIN_LOOP. . . . .  C ADDR   0040H   A   
NEXT_CHAR_ROUTINE.  C ADDR   00D9H   A   
P0 . . . . . . . .  D ADDR   0080H   A   
P3 . . . . . . . .  D ADDR   00B0H   A   
PASSW. . . . . . .  C ADDR   0033H   A   
RS . . . . . . . .  B ADDR   0090H.6 A   
RW . . . . . . . .  B ADDR   0090H.4 A   
SET_CURSOR_LINE1 .  C ADDR   00B5H   A   
SET_CURSOR_LINE2 .  C ADDR   00BAH   A   
START. . . . . . .  C ADDR   003EH   A   
TEXT_F . . . . . .  C ADDR   0024H   A   
TEXT_S . . . . . .  C ADDR   0018H   A   
USERIN . . . . . .  C ADDR   0039H   A   
WRONG. . . . . . .  C ADDR   0084H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
