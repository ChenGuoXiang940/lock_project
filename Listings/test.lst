A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 12:58:04 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\test.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE test.a51 SET(SMALL) DEBUG PRINT(.\Listings\test.lst) OBJECT(.\Objects\t
                      est.obj) EP

LOC  OBJ            LINE     SOURCE

0000                   1                 ORG 0000H
0000 0200AF            2                 LJMP START
                       3     
0003                   4                 ORG 0003H
0003 0201C2            5                 LJMP INT0_ISR
0013                   6                             ORG 0013H
0013 0201C9            7                 LJMP INT1_ISR
0016 50415353          8     TEXT1:          DB "PASSWORD BASED",0      ; 開機畫面第一行
001A 574F5244                
001E 20424153                
0022 454400                  
0025 53454355          9     TEXT2:          DB "SECURITY SYSTEM",0     ; 開機畫面第二行
0029 52495459                
002D 20535953                
0031 54454D00                
0035 53656C65         10     MSG_PREFIX:    DB "Select ", 0
0039 63742000                
003D 20444947         11     MSG_SUFFIX:    DB " DIGITS", 0
0041 49545300                
0045 444F4F52         12     TEXT_S:     DB "DOOR OPENED", 0
0049 204F5045                
004D 4E454400                
0051 57524F4E         13     TEXT_F:     DB "WRONG PASSWORD", 0
0055 47205041                
0059 5353574F                
005D 524400                  
0060 41434345         14     TEXT_S1:        DB "ACCESS - GRANTED",0    ; 成功訊息第一行
0064 5353202D                
0068 20475241                
006C 4E544544                
0070 00                      
0071 444F4F52         15     TEXT_S2:        DB "DOOR OPENED",0         ; 成功訊息第二行
0075 204F5045                
0079 4E454400                
007D 57524F4E         16     TEXT_F1:        DB "WRONG PASSWORD",0      ; 失敗訊息第一行
0081 47205041                
0085 5353574F                
0089 524400                  
008C 41434345         17     TEXT_F2:        DB "ACCESS DENIED",0       ; 失敗訊息第二行
0090 53532044                
0094 454E4945                
0098 4400                    
009A 494E5055         18     RESET_MSG: DB "INPUT CLEARED", 0
009E 5420434C                
00A2 45415245                
00A6 4400                    
                      19     
00A8 31323300         20     PASSW:      DB "123", 0     ; 正確密碼
00AC                  21     USERIN:     DS 3              ; 用來儲存輸入字元（30H~34H）
  0096                22                     RS BIT 0x96     ; P2.6
  0097                23                 EN BIT 0x97     ; P2.7
  0094                24                 RW BIT 0x94     ; P2.4
                      25     
00AF                  26     START:    
00AF 3155             27                             ACALL LCD_INIT
00B1 900016           28                             MOV DPTR,#TEXT1     ; 載入「PASSWORD BASED」
00B4 316F             29                             ACALL LCD_PRINT
A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 12:58:04 PAGE     2

00B6 319D             30                             ACALL LINE2
00B8 900025           31                             MOV DPTR,#TEXT2     ; 載入「SECURITY SYSTEM」
00BB 316F             32                             ACALL LCD_PRINT  
00BD 31B0             33                             ACALL Delay_2S;
00BF D2B2             34                 SETB P3.2
00C1 D288             35                 SETB IT0
00C3 D2A8             36                 SETB EX0
00C5 D2AF             37                 SETB EA
00C7 D2AA             38                             SETB EX1
00C9 D28A             39                 SETB IT1
00CB 7C00             40                             MOV R4, #0
                      41     
00CD                  42     MAIN_LOOP:
00CD D2AA             43                             SETB EX1
00CF D28A             44                 SETB IT1
00D1 3155             45                 ACALL LCD_INIT
00D3 11FD             46                 ACALL SHOW_REMAINING_DIGITS
00D5 7830             47                 MOV R0, #30H        ; 輸入次數計數器
00D7 7A30             48                 MOV R2, #'0'        ; 循環字元從 '0' 開始
00D9 7D00             49                             MOV R5, #0
00DB C225             50                             CLR 25H
                      51     
00DD                  52     INPUT_LOOP:
00DD 317E             53                             ACALL SET_CURSOR_LINE2
00DF EA               54                             MOV A, R2
00E0 3183             55                             ACALL LDAT
00E2 31B0             56                             ACALL DELAY_2S
00E4 BD0004           57                             CJNE R5, #0, HANDLE_ISR
00E7 31A2             58                             ACALL NEXT_CHAR_ROUTINE
00E9 80F2             59                             SJMP INPUT_LOOP
                      60     ; -------------------------------
                      61     ; 中斷執行 儲存當前字元到 USERIN[i]
                      62     ; -------------------------------
00EB                  63     HANDLE_ISR:
00EB EC               64                             MOV A, R4
00EC 2430             65                 ADD A, #30H
00EE F8               66                 MOV R0, A
00EF EA               67                 MOV A, R2
00F0 F6               68                 MOV @R0, A
00F1 0C               69                 INC R4
                      70     
00F2 BC03D8           71                 CJNE R4, #3, MAIN_LOOP
                      72     
                      73                 ; == 剛儲存完全部，開始比對 ==
00F5 3112             74                 ACALL CHECK_PASSWORD
00F7 314B             75                 ACALL CLEAR_USERIN
00F9 7C00             76                 MOV R4, #0
00FB 80D0             77                             SJMP MAIN_LOOP
                      78     
00FD                  79     SHOW_REMAINING_DIGITS:
00FD 3179             80                 ACALL SET_CURSOR_LINE1
                      81     
                      82                 ; 顯示 "Select "
00FF 900035           83                 MOV DPTR, #MSG_PREFIX
0102 316F             84                 ACALL LCD_PRINT
                      85     
                      86                 ; 顯示剩餘次數 = 3 - R4
0104 C3               87                 CLR C
0105 7403             88                 MOV A, #3
0107 9C               89                 SUBB A, R4
0108 2430             90                 ADD A, #30H
010A 3183             91                 ACALL LDAT
                      92     
                      93                 ; 顯示 " DIGITS"
010C 90003D           94                 MOV DPTR, #MSG_SUFFIX
010F 316F             95                 ACALL LCD_PRINT
A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 12:58:04 PAGE     3

                      96     
0111 22               97                 RET
                      98     ; -------------------------------
                      99     ; 密碼比對
                     100     ; -------------------------------
0112                 101     CHECK_PASSWORD:
0112 7B00            102                             MOV R3, #0
0114 9000A8          103                             MOV DPTR, #PASSW
                     104     
0117                 105     CHK_LOOP:
0117 EB              106                             MOV A, R3
0118 2430            107                             ADD A, #30H
011A F8              108                             MOV R0, A
011B E6              109                             MOV A, @R0
011C F540            110                             MOV 40H, A
                     111     
011E EB              112                             MOV A, R3
011F 93              113                             MOVC A, @A+DPTR
0120 B54017          114                             CJNE A, 40H, WRONG
                     115     
0123 0B              116                             INC R3
0124 BB03F0          117                             CJNE R3, #3, CHK_LOOP   ; 比對完 3 碼就跳出
0127 8000            118                             SJMP CORRECT
                     119     
0129                 120     CORRECT:
0129 3155            121                             ACALL LCD_INIT
012B 900060          122                             MOV DPTR, #TEXT_S1
012E 316F            123                             ACALL LCD_PRINT
0130 900071          124                             MOV DPTR, #TEXT_S2
0133 319D            125                             ACALL LINE2
0135 316F            126                             ACALL LCD_PRINT
0137 31B0            127                             ACALL DELAY_2S
0139 22              128                             RET
                     129     
013A                 130     WRONG:
013A 3155            131                             ACALL LCD_INIT
013C 90007D          132                             MOV DPTR, #TEXT_F1
013F 316F            133                             ACALL LCD_PRINT
0141 90008C          134                             MOV DPTR, #TEXT_F2
0144 319D            135                             ACALL LINE2
0146 316F            136                             ACALL LCD_PRINT
0148 31B0            137                             ACALL DELAY_2S
014A 22              138                             RET
014B                 139     CLEAR_USERIN:
014B 7905            140                 MOV R1, #5
014D 7830            141                 MOV R0, #30H
014F                 142     CLR_LOOP:
014F 7600            143                 MOV @R0, #0
0151 08              144                 INC R0
0152 D9FB            145                 DJNZ R1, CLR_LOOP
0154 22              146                 RET
                     147     
                     148     ; -------------------------------
                     149     ; LCD 初始與控制
                     150     ; -------------------------------
0155                 151     LCD_INIT:
0155 7438            152                 MOV A, #38H
0157 3190            153                 ACALL LCMD
0159 740C            154                 MOV A, #0CH
015B 3190            155                 ACALL LCMD
015D 7406            156                 MOV A, #06H
015F 3190            157                 ACALL LCMD
0161 7401            158                 MOV A, #01H
0163 3190            159                 ACALL LCMD
0165 7402            160                 MOV A, #02H
0167 3190            161                 ACALL LCMD
A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 12:58:04 PAGE     4

0169 22              162                 RET
                     163     
016A                 164     LCD_CLR:
016A 7401            165                 MOV A, #01H
016C 3190            166                 ACALL LCMD
016E 22              167                 RET
016F                 168     LCD_PRINT:
016F E4              169                 CLR A
0170 93              170                 MOVC A, @A+DPTR
0171 6005            171                 JZ DONE_PRINT
0173 3183            172                 ACALL LDAT
0175 A3              173                 INC DPTR
0176 80F7            174                 SJMP LCD_PRINT
0178                 175     DONE_PRINT:
0178 22              176                 RET
                     177     
0179                 178     SET_CURSOR_LINE1:
0179 7480            179                 MOV A, #80H
017B 3190            180                 ACALL LCMD
017D 22              181                 RET
                     182     
017E                 183     SET_CURSOR_LINE2:
017E 74C0            184                 MOV A, #0C0H
0180 3190            185                 ACALL LCMD
0182 22              186                 RET
                     187     
0183                 188     LDAT:
0183 F580            189                 MOV P0, A
0185 D296            190                 SETB RS
0187 C294            191                 CLR RW
0189 D297            192                 SETB EN
018B 31B9            193                 ACALL DELAY
018D C297            194                 CLR EN
018F 22              195                 RET
                     196     
0190                 197     LCMD:
0190 F580            198                 MOV P0, A
0192 C296            199                 CLR RS
0194 C294            200                 CLR RW
0196 D297            201                 SETB EN
0198 31B9            202                 ACALL DELAY
019A C297            203                 CLR EN
019C 22              204                 RET
019D                 205     LINE2:
019D 74C0            206        MOV A,#0C0H
019F 3190            207        ACALL LCMD
01A1 22              208        RET
                     209     
                     210     ; -------------------------------
                     211     ; 下一個字元 '0'~'9','A'~'F' 循環
                     212     ; -------------------------------
01A2                 213     NEXT_CHAR_ROUTINE:
01A2 0A              214                 INC R2
01A3 BA3A04          215                 CJNE R2, #'9'+1, AF_CHECK  ; 跳到 AF_CHECK 檢查是否超過 'F'
01A6 7A41            216                 MOV R2, #'A'
01A8 8005            217                 SJMP DONE_NEXT
                     218     
01AA                 219     AF_CHECK:
01AA BA4702          220                 CJNE R2, #'F'+1, DONE_NEXT ; 檢查是否超過 'F'
01AD 7A30            221                 MOV R2, #'0'              ; 若超過，回到 '0'
                     222     
01AF                 223     DONE_NEXT:
01AF 22              224                 RET
                     225     
                     226     ; -------------------------------
                     227     ; 延遲副程式
A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 12:58:04 PAGE     5

                     228     ; -------------------------------
01B0                 229     DELAY_2S:
01B0 31B9            230                 ACALL DELAY
01B2 31B9            231                 ACALL DELAY
01B4 31B9            232                 ACALL DELAY
01B6 31B9            233                 ACALL DELAY
01B8 22              234                 RET
                     235     
01B9                 236     DELAY:
01B9 7FFF            237                 MOV R7, #255
01BB 7EFF            238     D1:         MOV R6, #255
01BD DEFE            239     D2:         DJNZ R6, D2
01BF DFFA            240                 DJNZ R7, D1
01C1 22              241                 RET
                     242     
01C2                 243     INT0_ISR:
01C2 7D01            244                             MOV R5, #1
01C4 D225            245                 SETB 25H
01C6 C289            246                 CLR IE0
01C8 32              247                 RETI
01C9                 248     INT1_ISR:
01C9 3155            249                             ACALL LCD_INIT
01CB 90009A          250                             MOV DPTR, #RESET_MSG
01CE 316F            251                             ACALL LCD_PRINT
01D0 31B0            252                             ACALL DELAY_2S
01D2 314B            253                 ACALL CLEAR_USERIN
01D4 7C00            254                 MOV R4, #0     
01D6 C28B            255                 CLR IE1        
01D8 0200CD          256                 LJMP MAIN_LOOP 
                     257        END
A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 12:58:04 PAGE     6

SYMBOL TABLE LISTING
------ ----- -------


N A M E                T Y P E  V A L U E   ATTRIBUTES

AF_CHECK. . . . . . .  C ADDR   01AAH   A   
CHECK_PASSWORD. . . .  C ADDR   0112H   A   
CHK_LOOP. . . . . . .  C ADDR   0117H   A   
CLEAR_USERIN. . . . .  C ADDR   014BH   A   
CLR_LOOP. . . . . . .  C ADDR   014FH   A   
CORRECT . . . . . . .  C ADDR   0129H   A   
D1. . . . . . . . . .  C ADDR   01BBH   A   
D2. . . . . . . . . .  C ADDR   01BDH   A   
DELAY . . . . . . . .  C ADDR   01B9H   A   
DELAY_2S. . . . . . .  C ADDR   01B0H   A   
DONE_NEXT . . . . . .  C ADDR   01AFH   A   
DONE_PRINT. . . . . .  C ADDR   0178H   A   
EA. . . . . . . . . .  B ADDR   00A8H.7 A   
EN. . . . . . . . . .  B ADDR   0090H.7 A   
EX0 . . . . . . . . .  B ADDR   00A8H.0 A   
EX1 . . . . . . . . .  B ADDR   00A8H.2 A   
HANDLE_ISR. . . . . .  C ADDR   00EBH   A   
IE0 . . . . . . . . .  B ADDR   0088H.1 A   
IE1 . . . . . . . . .  B ADDR   0088H.3 A   
INPUT_LOOP. . . . . .  C ADDR   00DDH   A   
INT0_ISR. . . . . . .  C ADDR   01C2H   A   
INT1_ISR. . . . . . .  C ADDR   01C9H   A   
IT0 . . . . . . . . .  B ADDR   0088H.0 A   
IT1 . . . . . . . . .  B ADDR   0088H.2 A   
LCD_CLR . . . . . . .  C ADDR   016AH   A   
LCD_INIT. . . . . . .  C ADDR   0155H   A   
LCD_PRINT . . . . . .  C ADDR   016FH   A   
LCMD. . . . . . . . .  C ADDR   0190H   A   
LDAT. . . . . . . . .  C ADDR   0183H   A   
LINE2 . . . . . . . .  C ADDR   019DH   A   
MAIN_LOOP . . . . . .  C ADDR   00CDH   A   
MSG_PREFIX. . . . . .  C ADDR   0035H   A   
MSG_SUFFIX. . . . . .  C ADDR   003DH   A   
NEXT_CHAR_ROUTINE . .  C ADDR   01A2H   A   
P0. . . . . . . . . .  D ADDR   0080H   A   
P3. . . . . . . . . .  D ADDR   00B0H   A   
PASSW . . . . . . . .  C ADDR   00A8H   A   
RESET_MSG . . . . . .  C ADDR   009AH   A   
RS. . . . . . . . . .  B ADDR   0090H.6 A   
RW. . . . . . . . . .  B ADDR   0090H.4 A   
SET_CURSOR_LINE1. . .  C ADDR   0179H   A   
SET_CURSOR_LINE2. . .  C ADDR   017EH   A   
SHOW_REMAINING_DIGITS  C ADDR   00FDH   A   
START . . . . . . . .  C ADDR   00AFH   A   
TEXT1 . . . . . . . .  C ADDR   0016H   A   
TEXT2 . . . . . . . .  C ADDR   0025H   A   
TEXT_F. . . . . . . .  C ADDR   0051H   A   
TEXT_F1 . . . . . . .  C ADDR   007DH   A   
TEXT_F2 . . . . . . .  C ADDR   008CH   A   
TEXT_S. . . . . . . .  C ADDR   0045H   A   
TEXT_S1 . . . . . . .  C ADDR   0060H   A   
TEXT_S2 . . . . . . .  C ADDR   0071H   A   
USERIN. . . . . . . .  C ADDR   00ACH   A   
WRONG . . . . . . . .  C ADDR   013AH   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
