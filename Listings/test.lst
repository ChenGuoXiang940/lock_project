A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 15:02:55 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\test.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE test.a51 SET(SMALL) DEBUG PRINT(.\Listings\test.lst) OBJECT(.\Objects\t
                      est.obj) EP

LOC  OBJ            LINE     SOURCE

0000                   1                 ORG 0000H
0000 0200AF            2                 LJMP START
0003                   3                 ORG 0003H
0003 0201D8            4                 LJMP INT0_ISR
0013                   5                             ORG 0013H
0013 0201DF            6                 LJMP INT1_ISR
                       7     
0016 50415353          8     TEXT1:          DB "PASSWORD BASED",0      ; 開機畫面第一行
001A 574F5244                
001E 20424153                
0022 454400                  
0025 53454355          9     TEXT2:          DB "SECURITY SYSTEM",0     ; 開機畫面第二行
0029 52495459                
002D 20535953                
0031 54454D00                
0035 53656C65         10     MSG_PREFIX:    DB "Select ", 0
0039 63742000                
003D 20444947         11     MSG_SUFFIX:    DB " DIGITS", 0
0041 49545300                
0045 444F4F52         12     TEXT_S:     DB "DOOR OPENED", 0
0049 204F5045                
004D 4E454400                
0051 57524F4E         13     TEXT_F:     DB "WRONG PASSWORD", 0
0055 47205041                
0059 5353574F                
005D 524400                  
0060 41434345         14     TEXT_S1:        DB "ACCESS - GRANTED",0    ; 成功訊息第一行
0064 5353202D                
0068 20475241                
006C 4E544544                
0070 00                      
0071 444F4F52         15     TEXT_S2:        DB "DOOR OPENED",0         ; 成功訊息第二行
0075 204F5045                
0079 4E454400                
007D 57524F4E         16     TEXT_F1:        DB "WRONG PASSWORD",0      ; 失敗訊息第一行
0081 47205041                
0085 5353574F                
0089 524400                  
008C 41434345         17     TEXT_F2:        DB "ACCESS DENIED",0       ; 失敗訊息第二行
0090 53532044                
0094 454E4945                
0098 4400                    
009A 494E5055         18     RESET_MSG: DB "INPUT CLEARED", 0
009E 5420434C                
00A2 45415245                
00A6 4400                    
00A8 31323300         19     PASSW:      DB "123", 0     ; 正確密碼
00AC                  20     USERIN:     DS 3              ; 用來儲存輸入字元（30H~34H）
  0096                21                     RS BIT 0x96     ; P2.6
  0097                22                 EN BIT 0x97     ; P2.7
  0094                23                 RW BIT 0x94     ; P2.4
                      24     
00AF                  25     START:    
00AF 316B             26                             ACALL LCD_INIT
00B1 900016           27                             MOV DPTR,#TEXT1     ; 載入「PASSWORD BASED」
00B4 3185             28                             ACALL LCD_PRINT
00B6 31B3             29                             ACALL LINE2
A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 15:02:55 PAGE     2

00B8 900025           30                             MOV DPTR,#TEXT2     ; 載入「SECURITY SYSTEM」
00BB 3185             31                             ACALL LCD_PRINT  
00BD 31C6             32                             ACALL Delay_2S;
00BF D2B2             33                 SETB P3.2
00C1 D288             34                 SETB IT0
00C3 D2A8             35                 SETB EX0
00C5 D2B3             36                             SETB P3.3
00C7 D2AA             37                             SETB EX1
00C9 D28A             38                 SETB IT1
00CB D2AF             39                             SETB EA
00CD 7C00             40                             MOV R4, #0
                      41     
00CF                  42     MAIN_LOOP:
00CF 316B             43                 ACALL LCD_INIT
00D1 3113             44                 ACALL SHOW_REMAINING_DIGITS
00D3 7830             45                 MOV R0, #30H        ; 輸入次數計數器
00D5 7A30             46                 MOV R2, #'0'        ; 循環字元從 '0' 開始
00D7 7D00             47                             MOV R5, #0
00D9 C225             48                             CLR 25H
                      49     
00DB                  50     INPUT_LOOP:
00DB 3194             51                             ACALL SET_CURSOR_LINE2
00DD EA               52                             MOV A, R2
00DE 3199             53                             ACALL LDAT
00E0 31C6             54                             ACALL DELAY_2S
00E2 BD0004           55                             CJNE R5, #0, HANDLE_ISR
00E5 31B8             56                             ACALL NEXT_CHAR_ROUTINE
00E7 80F2             57                             SJMP INPUT_LOOP
                      58     ; --------------------------------------------
                      59     ; 中斷執行 INT0: 儲存當前字元 INT1: 重新輸入密碼
                      60     ; --------------------------------------------
00E9                  61     HANDLE_ISR:
00E9 BD0213           62                 CJNE R5, #2, HANDLE_NORMAL_INPUT
00EC 316B             63                 ACALL LCD_INIT
00EE 90009A           64                 MOV DPTR, #RESET_MSG
00F1 3185             65                 ACALL LCD_PRINT
00F3 31C6             66                 ACALL DELAY_2S
00F5 3161             67                 ACALL CLEAR_USERIN
00F7 7C00             68                 MOV R4, #0
00F9 C28B             69                 CLR IE1
00FB 7D00             70                 MOV R5, #0
00FD 80D0             71                 SJMP MAIN_LOOP
                      72     
00FF                  73     HANDLE_NORMAL_INPUT:
00FF EC               74                 MOV A, R4
0100 2430             75                 ADD A, #30H
0102 F8               76                 MOV R0, A
0103 EA               77                 MOV A, R2
0104 F6               78                 MOV @R0, A
0105 0C               79                 INC R4
                      80             
0106 BC03C6           81                 CJNE R4, #3, MAIN_LOOP
                      82             
0109 3128             83                 ACALL CHECK_PASSWORD
010B 3161             84                 ACALL CLEAR_USERIN
010D 7C00             85                 MOV R4, #0
010F 7D00             86                 MOV R5, #0
0111 80BC             87                 SJMP MAIN_LOOP 
0113                  88     SHOW_REMAINING_DIGITS:
0113 318F             89                 ACALL SET_CURSOR_LINE1
                      90     
                      91                 ; 顯示 "Select "
0115 900035           92                 MOV DPTR, #MSG_PREFIX
0118 3185             93                 ACALL LCD_PRINT
                      94     
                      95                 ; 顯示剩餘次數 = 3 - R4
A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 15:02:55 PAGE     3

011A C3               96                 CLR C
011B 7403             97                 MOV A, #3
011D 9C               98                 SUBB A, R4
011E 2430             99                 ADD A, #30H
0120 3199            100                 ACALL LDAT
                     101     
                     102                 ; 顯示 " DIGITS"
0122 90003D          103                 MOV DPTR, #MSG_SUFFIX
0125 3185            104                 ACALL LCD_PRINT
                     105     
0127 22              106                 RET
                     107     ; -------------------------------
                     108     ; 密碼比對
                     109     ; -------------------------------
0128                 110     CHECK_PASSWORD:
0128 7B00            111                             MOV R3, #0
012A 9000A8          112                             MOV DPTR, #PASSW
                     113     
012D                 114     CHK_LOOP:
012D EB              115                             MOV A, R3
012E 2430            116                             ADD A, #30H
0130 F8              117                             MOV R0, A
0131 E6              118                             MOV A, @R0
0132 F540            119                             MOV 40H, A
                     120     
0134 EB              121                             MOV A, R3
0135 93              122                             MOVC A, @A+DPTR
0136 B54017          123                             CJNE A, 40H, WRONG
                     124     
0139 0B              125                             INC R3
013A BB03F0          126                             CJNE R3, #3, CHK_LOOP   ; 比對完 3 碼就跳出
013D 8000            127                             SJMP CORRECT
                     128     
013F                 129     CORRECT:
013F 316B            130                             ACALL LCD_INIT
0141 900060          131                             MOV DPTR, #TEXT_S1
0144 3185            132                             ACALL LCD_PRINT
0146 900071          133                             MOV DPTR, #TEXT_S2
0149 31B3            134                             ACALL LINE2
014B 3185            135                             ACALL LCD_PRINT
014D 31C6            136                             ACALL DELAY_2S
014F 22              137                             RET
                     138     
0150                 139     WRONG:
0150 316B            140                             ACALL LCD_INIT
0152 90007D          141                             MOV DPTR, #TEXT_F1
0155 3185            142                             ACALL LCD_PRINT
0157 90008C          143                             MOV DPTR, #TEXT_F2
015A 31B3            144                             ACALL LINE2
015C 3185            145                             ACALL LCD_PRINT
015E 31C6            146                             ACALL DELAY_2S
0160 22              147                             RET
0161                 148     CLEAR_USERIN:
0161 7905            149                 MOV R1, #5
0163 7830            150                 MOV R0, #30H
0165                 151     CLR_LOOP:
0165 7600            152                 MOV @R0, #0
0167 08              153                 INC R0
0168 D9FB            154                 DJNZ R1, CLR_LOOP
016A 22              155                 RET
                     156     
                     157     ; -------------------------------
                     158     ; LCD 初始與控制
                     159     ; -------------------------------
016B                 160     LCD_INIT:
016B 7438            161                 MOV A, #38H
A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 15:02:55 PAGE     4

016D 31A6            162                 ACALL LCMD
016F 740C            163                 MOV A, #0CH
0171 31A6            164                 ACALL LCMD
0173 7406            165                 MOV A, #06H
0175 31A6            166                 ACALL LCMD
0177 7401            167                 MOV A, #01H
0179 31A6            168                 ACALL LCMD
017B 7402            169                 MOV A, #02H
017D 31A6            170                 ACALL LCMD
017F 22              171                 RET
                     172     
0180                 173     LCD_CLR:
0180 7401            174                 MOV A, #01H
0182 31A6            175                 ACALL LCMD
0184 22              176                 RET
0185                 177     LCD_PRINT:
0185 E4              178                 CLR A
0186 93              179                 MOVC A, @A+DPTR
0187 6005            180                 JZ DONE_PRINT
0189 3199            181                 ACALL LDAT
018B A3              182                 INC DPTR
018C 80F7            183                 SJMP LCD_PRINT
018E                 184     DONE_PRINT:
018E 22              185                 RET
                     186     
018F                 187     SET_CURSOR_LINE1:
018F 7480            188                 MOV A, #80H
0191 31A6            189                 ACALL LCMD
0193 22              190                 RET
                     191     
0194                 192     SET_CURSOR_LINE2:
0194 74C0            193                 MOV A, #0C0H
0196 31A6            194                 ACALL LCMD
0198 22              195                 RET
                     196     
0199                 197     LDAT:
0199 F580            198                 MOV P0, A
019B D296            199                 SETB RS
019D C294            200                 CLR RW
019F D297            201                 SETB EN
01A1 31CF            202                 ACALL DELAY
01A3 C297            203                 CLR EN
01A5 22              204                 RET
                     205     
01A6                 206     LCMD:
01A6 F580            207                 MOV P0, A
01A8 C296            208                 CLR RS
01AA C294            209                 CLR RW
01AC D297            210                 SETB EN
01AE 31CF            211                 ACALL DELAY
01B0 C297            212                 CLR EN
01B2 22              213                 RET
01B3                 214     LINE2:
01B3 74C0            215        MOV A,#0C0H
01B5 31A6            216        ACALL LCMD
01B7 22              217        RET
                     218     
                     219     ; -------------------------------
                     220     ; 下一個字元 '0'~'9','A'~'F' 循環
                     221     ; -------------------------------
01B8                 222     NEXT_CHAR_ROUTINE:
01B8 0A              223                 INC R2
01B9 BA3A04          224                 CJNE R2, #'9'+1, AF_CHECK  ; 跳到 AF_CHECK 檢查是否超過 'F'
01BC 7A41            225                 MOV R2, #'A'
01BE 8005            226                 SJMP DONE_NEXT
                     227     
A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 15:02:55 PAGE     5

01C0                 228     AF_CHECK:
01C0 BA4702          229                 CJNE R2, #'F'+1, DONE_NEXT ; 檢查是否超過 'F'
01C3 7A30            230                 MOV R2, #'0'              ; 若超過，回到 '0'
                     231     
01C5                 232     DONE_NEXT:
01C5 22              233                 RET
                     234     
                     235     ; -------------------------------
                     236     ; 延遲副程式
                     237     ; -------------------------------
01C6                 238     DELAY_2S:
01C6 31CF            239                 ACALL DELAY
01C8 31CF            240                 ACALL DELAY
01CA 31CF            241                 ACALL DELAY
01CC 31CF            242                 ACALL DELAY
01CE 22              243                 RET
                     244     
01CF                 245     DELAY:
01CF 7FFF            246                 MOV R7, #255
01D1 7EFF            247     D1:         MOV R6, #255
01D3 DEFE            248     D2:         DJNZ R6, D2
01D5 DFFA            249                 DJNZ R7, D1
01D7 22              250                 RET
                     251     
01D8                 252     INT0_ISR:
01D8 7D01            253                             MOV R5, #1
01DA D225            254                 SETB 25H
01DC C289            255                 CLR IE0
01DE 32              256                 RETI
01DF                 257     INT1_ISR:
01DF 7D02            258                             MOV R5, #2
01E1 D225            259                 SETB 25H
01E3 C28B            260                 CLR IE1
01E5 32              261                 RETI
                     262     
                     263                 END
A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 15:02:55 PAGE     6

SYMBOL TABLE LISTING
------ ----- -------


N A M E                T Y P E  V A L U E   ATTRIBUTES

AF_CHECK. . . . . . .  C ADDR   01C0H   A   
CHECK_PASSWORD. . . .  C ADDR   0128H   A   
CHK_LOOP. . . . . . .  C ADDR   012DH   A   
CLEAR_USERIN. . . . .  C ADDR   0161H   A   
CLR_LOOP. . . . . . .  C ADDR   0165H   A   
CORRECT . . . . . . .  C ADDR   013FH   A   
D1. . . . . . . . . .  C ADDR   01D1H   A   
D2. . . . . . . . . .  C ADDR   01D3H   A   
DELAY . . . . . . . .  C ADDR   01CFH   A   
DELAY_2S. . . . . . .  C ADDR   01C6H   A   
DONE_NEXT . . . . . .  C ADDR   01C5H   A   
DONE_PRINT. . . . . .  C ADDR   018EH   A   
EA. . . . . . . . . .  B ADDR   00A8H.7 A   
EN. . . . . . . . . .  B ADDR   0090H.7 A   
EX0 . . . . . . . . .  B ADDR   00A8H.0 A   
EX1 . . . . . . . . .  B ADDR   00A8H.2 A   
HANDLE_ISR. . . . . .  C ADDR   00E9H   A   
HANDLE_NORMAL_INPUT .  C ADDR   00FFH   A   
IE0 . . . . . . . . .  B ADDR   0088H.1 A   
IE1 . . . . . . . . .  B ADDR   0088H.3 A   
INPUT_LOOP. . . . . .  C ADDR   00DBH   A   
INT0_ISR. . . . . . .  C ADDR   01D8H   A   
INT1_ISR. . . . . . .  C ADDR   01DFH   A   
IT0 . . . . . . . . .  B ADDR   0088H.0 A   
IT1 . . . . . . . . .  B ADDR   0088H.2 A   
LCD_CLR . . . . . . .  C ADDR   0180H   A   
LCD_INIT. . . . . . .  C ADDR   016BH   A   
LCD_PRINT . . . . . .  C ADDR   0185H   A   
LCMD. . . . . . . . .  C ADDR   01A6H   A   
LDAT. . . . . . . . .  C ADDR   0199H   A   
LINE2 . . . . . . . .  C ADDR   01B3H   A   
MAIN_LOOP . . . . . .  C ADDR   00CFH   A   
MSG_PREFIX. . . . . .  C ADDR   0035H   A   
MSG_SUFFIX. . . . . .  C ADDR   003DH   A   
NEXT_CHAR_ROUTINE . .  C ADDR   01B8H   A   
P0. . . . . . . . . .  D ADDR   0080H   A   
P3. . . . . . . . . .  D ADDR   00B0H   A   
PASSW . . . . . . . .  C ADDR   00A8H   A   
RESET_MSG . . . . . .  C ADDR   009AH   A   
RS. . . . . . . . . .  B ADDR   0090H.6 A   
RW. . . . . . . . . .  B ADDR   0090H.4 A   
SET_CURSOR_LINE1. . .  C ADDR   018FH   A   
SET_CURSOR_LINE2. . .  C ADDR   0194H   A   
SHOW_REMAINING_DIGITS  C ADDR   0113H   A   
START . . . . . . . .  C ADDR   00AFH   A   
TEXT1 . . . . . . . .  C ADDR   0016H   A   
TEXT2 . . . . . . . .  C ADDR   0025H   A   
TEXT_F. . . . . . . .  C ADDR   0051H   A   
TEXT_F1 . . . . . . .  C ADDR   007DH   A   
TEXT_F2 . . . . . . .  C ADDR   008CH   A   
TEXT_S. . . . . . . .  C ADDR   0045H   A   
TEXT_S1 . . . . . . .  C ADDR   0060H   A   
TEXT_S2 . . . . . . .  C ADDR   0071H   A   
USERIN. . . . . . . .  C ADDR   00ACH   A   
WRONG . . . . . . . .  C ADDR   0150H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
A51 MACRO ASSEMBLER  TEST                                                                 06/12/2025 15:02:55 PAGE     7

