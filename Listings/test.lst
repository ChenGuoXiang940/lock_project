A51 MACRO ASSEMBLER  TEST                                                                 06/13/2025 11:03:31 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\test.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE test.a51 SET(SMALL) DEBUG PRINT(.\Listings\test.lst) OBJECT(.\Objects\t
                      est.obj) EP

LOC  OBJ            LINE     SOURCE

0000                   1                 ORG 0000H
0000 0200B3            2                 LJMP START
0003                   3                 ORG 0003H
0003 0201E5            4                 LJMP INT0_ISR
0013                   5                             ORG 0013H
0013 0201EC            6                 LJMP INT1_ISR
                       7     
0016 50415353          8     TEXT1:          DB "PASSWORD BASED",0      ; 開機畫面第一行
001A 574F5244                
001E 20424153                
0022 454400                  
0025 53454355          9     TEXT2:          DB "SECURITY SYSTEM",0     ; 開機畫面第二行
0029 52495459                
002D 20535953                
0031 54454D00                
0035 53656C65         10     MSG_PREFIX:    DB "Select ", 0
0039 63742000                
003D 20444947         11     MSG_SUFFIX:    DB " DIGITS", 0
0041 49545300                
0045 444F4F52         12     TEXT_S:     DB "DOOR OPENED", 0
0049 204F5045                
004D 4E454400                
0051 57524F4E         13     TEXT_F:     DB "WRONG PASSWORD", 0
0055 47205041                
0059 5353574F                
005D 524400                  
0060 41434345         14     TEXT_S1:        DB "ACCESS - GRANTED",0    ; 成功訊息第一行
0064 5353202D                
0068 20475241                
006C 4E544544                
0070 00                      
0071 444F4F52         15     TEXT_S2:        DB "DOOR OPENED",0         ; 成功訊息第二行
0075 204F5045                
0079 4E454400                
007D 57524F4E         16     TEXT_F1:        DB "WRONG PASSWORD",0      ; 失敗訊息第一行
0081 47205041                
0085 5353574F                
0089 524400                  
008C 41434345         17     TEXT_F2:        DB "ACCESS DENIED",0       ; 失敗訊息第二行
0090 53532044                
0094 454E4945                
0098 4400                    
009A 494E5055         18     RESET_MSG: DB "INPUT CLEARED", 0
009E 5420434C                
00A2 45415245                
00A6 4400                    
00A8 31323334         19     PASSW:      DB "12345", 0     ; 正確密碼
00AC 3500                    
00AE                  20     USERIN:     DS 5              ; 用來儲存輸入字元（30H~34H）
  0096                21                     RS BIT 0x96     ; P2.6
  0097                22                 EN BIT 0x97     ; P2.7
  0094                23                 RW BIT 0x94     ; P2.4
                      24     
00B3                  25     START:    
00B3 317D             26                             ACALL LCD_INIT
00B5 900016           27                             MOV DPTR,#TEXT1     ; 載入「PASSWORD BASED」
00B8 3197             28                             ACALL LCD_PRINT
A51 MACRO ASSEMBLER  TEST                                                                 06/13/2025 11:03:31 PAGE     2

00BA 31A6             29                             ACALL SET_CURSOR_LINE2
00BC 900025           30                             MOV DPTR,#TEXT2     ; 載入「SECURITY SYSTEM」
00BF 3197             31                             ACALL LCD_PRINT  
00C1 31D3             32                             ACALL Delay_2S;
00C3 D2B2             33                 SETB P3.2
00C5 D288             34                 SETB IT0
00C7 D2A8             35                 SETB EX0
00C9 D2B3             36                             SETB P3.3
00CB D2AA             37                             SETB EX1
00CD D28A             38                 SETB IT1
00CF D2AF             39                             SETB EA
00D1 7C00             40                             MOV R4, #0
                      41     
00D3                  42     MAIN_LOOP:
00D3 317D             43                 ACALL LCD_INIT
00D5 3119             44                 ACALL SHOW_REMAINING_DIGITS
00D7 7830             45                 MOV R0, #30H        ; 輸入次數計數器
00D9 7A30             46                 MOV R2, #'0'        ; 循環字元從 '0' 開始
00DB 7D00             47                             MOV R5, #0
                      48     
00DD                  49     INPUT_LOOP:
00DD 31A6             50                             ACALL SET_CURSOR_LINE2
00DF EA               51                             MOV A, R2
00E0 31AB             52                             ACALL LDAT
00E2 31D3             53                             ACALL DELAY_2S
00E4 BD0004           54                             CJNE R5, #0, HANDLE_ISR
00E7 31C5             55                             ACALL NEXT_CHAR_ROUTINE
00E9 80F2             56                             SJMP INPUT_LOOP
                      57     ; --------------------------------------------
                      58     ; 中斷執行 INT0: 儲存當前字元 INT1: 重新輸入密碼
                      59     ; --------------------------------------------
00EB                  60     HANDLE_ISR:
00EB BD0215           61                 CJNE R5, #2, HANDLE_NORMAL_INPUT
00EE 317D             62                 ACALL LCD_INIT
00F0 90009A           63                 MOV DPTR, #RESET_MSG
00F3 3197             64                 ACALL LCD_PRINT
00F5 31D3             65                 ACALL DELAY_2S
00F7 3173             66                 ACALL CLEAR_USERIN
00F9 7C00             67                 MOV R4, #0
00FB C28B             68                 CLR IE1
00FD 7D00             69                 MOV R5, #0
00FF C225             70                 CLR 25H
0101 80D0             71                 SJMP MAIN_LOOP
                      72     
0103                  73     HANDLE_NORMAL_INPUT:
0103 EC               74                 MOV A, R4
0104 2430             75                 ADD A, #30H
0106 F8               76                 MOV R0, A
0107 EA               77                 MOV A, R2
0108 F6               78                 MOV @R0, A
0109 0C               79                 INC R4
010A BC05C6           80                 CJNE R4, #5, MAIN_LOOP
                      81             
010D 312E             82                 ACALL CHECK_PASSWORD
010F                  83     HANDLE_RET:
010F 3173             84                 ACALL CLEAR_USERIN
0111 7C00             85                 MOV R4, #0
0113 7D00             86                 MOV R5, #0
0115 C225             87                 CLR 25H
0117 809A             88                 SJMP START
0119                  89     SHOW_REMAINING_DIGITS:
0119 31A1             90                 ACALL SET_CURSOR_LINE1
                      91     
                      92                 ; 顯示 "Select "
011B 900035           93                 MOV DPTR, #MSG_PREFIX
011E 3197             94                 ACALL LCD_PRINT
A51 MACRO ASSEMBLER  TEST                                                                 06/13/2025 11:03:31 PAGE     3

                      95     
                      96                 ; 顯示剩餘次數
0120 C3               97                 CLR C
0121 7405             98                 MOV A, #5
0123 9C               99                 SUBB A, R4
0124 2430            100                 ADD A, #30H
0126 31AB            101                 ACALL LDAT
                     102     
                     103                 ; 顯示 " DIGITS"
0128 90003D          104                 MOV DPTR, #MSG_SUFFIX
012B 3197            105                 ACALL LCD_PRINT
                     106     
012D 22              107                 RET
                     108     ; -------------------------------
                     109     ; 密碼比對
                     110     ; -------------------------------
012E                 111     CHECK_PASSWORD:
012E 7B00            112                             MOV R3, #0
0130 9000A8          113                             MOV DPTR, #PASSW
                     114     
0133                 115     CHK_LOOP:
0133 EB              116                             MOV A, R3
0134 2430            117                             ADD A, #30H
0136 F8              118                             MOV R0, A
0137 E6              119                             MOV A, @R0
0138 F540            120                             MOV 40H, A
                     121     
013A EB              122                             MOV A, R3
013B 93              123                             MOVC A, @A+DPTR
013C B54020          124                             CJNE A, 40H, WRONG
                     125     
013F 0B              126                             INC R3
0140 BB05F0          127                             CJNE R3, #5, CHK_LOOP   ; 比對完 5 碼就跳出
0143 8000            128                             SJMP CORRECT
                     129     
0145                 130     CORRECT:
0145 317D            131                             ACALL LCD_INIT
0147 900060          132                             MOV DPTR, #TEXT_S1
014A 3197            133                             ACALL LCD_PRINT
014C 900071          134                             MOV DPTR, #TEXT_S2
014F 31A6            135                             ACALL SET_CURSOR_LINE2
0151 3197            136                             ACALL LCD_PRINT
0153 31D3            137                             ACALL DELAY_2S
0155 31D3            138                             ACALL DELAY_2S
0157 31D3            139                             ACALL DELAY_2S
0159 31D3            140                             ACALL DELAY_2S
015B 31D3            141                             ACALL DELAY_2S
015D 80B0            142                             SJMP HANDLE_RET
                     143     
015F                 144     WRONG:
015F 317D            145                             ACALL LCD_INIT
0161 90007D          146                             MOV DPTR, #TEXT_F1
0164 3197            147                             ACALL LCD_PRINT
0166 90008C          148                             MOV DPTR, #TEXT_F2
0169 31A6            149                             ACALL SET_CURSOR_LINE2
016B 3197            150                             ACALL LCD_PRINT
016D 31D3            151                             ACALL DELAY_2S
016F 31FC            152                             ACALL PLAY_ALERT
0171 809C            153                             SJMP HANDLE_RET
0173                 154     CLEAR_USERIN:
0173 7905            155                 MOV R1, #5
0175 7830            156                 MOV R0, #30H
0177                 157     CLR_LOOP:
0177 7600            158                 MOV @R0, #0
0179 08              159                 INC R0
017A D9FB            160                 DJNZ R1, CLR_LOOP
A51 MACRO ASSEMBLER  TEST                                                                 06/13/2025 11:03:31 PAGE     4

017C 22              161                 RET
                     162     
                     163     ; -------------------------------
                     164     ; LCD 初始與控制
                     165     ; -------------------------------
017D                 166     LCD_INIT:
017D 7438            167                 MOV A, #38H
017F 31B8            168                 ACALL LCMD
0181 740C            169                 MOV A, #0CH
0183 31B8            170                 ACALL LCMD
0185 7406            171                 MOV A, #06H
0187 31B8            172                 ACALL LCMD
0189 7401            173                 MOV A, #01H
018B 31B8            174                 ACALL LCMD
018D 7402            175                 MOV A, #02H
018F 31B8            176                 ACALL LCMD
0191 22              177                 RET
                     178     
0192                 179     LCD_CLR:
0192 7401            180                 MOV A, #01H
0194 31B8            181                 ACALL LCMD
0196 22              182                 RET
0197                 183     LCD_PRINT:
0197 E4              184                 CLR A
0198 93              185                 MOVC A, @A+DPTR
0199 6005            186                 JZ DONE_PRINT
019B 31AB            187                 ACALL LDAT
019D A3              188                 INC DPTR
019E 80F7            189                 SJMP LCD_PRINT
01A0                 190     DONE_PRINT:
01A0 22              191                 RET
                     192     
01A1                 193     SET_CURSOR_LINE1:
01A1 7480            194                 MOV A, #80H
01A3 31B8            195                 ACALL LCMD
01A5 22              196                 RET
01A6                 197     SET_CURSOR_LINE2:
01A6 74C0            198                 MOV A, #0C0H
01A8 31B8            199                 ACALL LCMD
01AA 22              200                 RET
                     201     
01AB                 202     LDAT:
01AB F580            203                 MOV P0, A
01AD D296            204                 SETB RS
01AF C294            205                 CLR RW
01B1 D297            206                 SETB EN
01B3 31DC            207                 ACALL DELAY
01B5 C297            208                 CLR EN
01B7 22              209                 RET
                     210     
01B8                 211     LCMD:
01B8 F580            212                 MOV P0, A
01BA C296            213                 CLR RS
01BC C294            214                 CLR RW
01BE D297            215                 SETB EN
01C0 31DC            216                 ACALL DELAY
01C2 C297            217                 CLR EN
01C4 22              218                 RET
                     219     ; -------------------------------
                     220     ; 下一個字元 '0'~'9','A'~'F' 循環
                     221     ; -------------------------------
01C5                 222     NEXT_CHAR_ROUTINE:
01C5 0A              223                 INC R2
01C6 BA3A04          224                 CJNE R2, #'9'+1, AF_CHECK  ; 跳到 AF_CHECK 檢查是否超過 'F'
01C9 7A41            225                 MOV R2, #'A'
01CB 8005            226                 SJMP DONE_NEXT
A51 MACRO ASSEMBLER  TEST                                                                 06/13/2025 11:03:31 PAGE     5

                     227     
01CD                 228     AF_CHECK:
01CD BA4702          229                 CJNE R2, #'F'+1, DONE_NEXT ; 檢查是否超過 'F'
01D0 7A30            230                 MOV R2, #'0'              ; 若超過，回到 '0'
                     231     
01D2                 232     DONE_NEXT:
01D2 22              233                 RET
                     234     
                     235     ; -------------------------------
                     236     ; 延遲副程式
                     237     ; -------------------------------
01D3                 238     DELAY_2S:
01D3 31DC            239                 ACALL DELAY
01D5 31DC            240                 ACALL DELAY
01D7 31DC            241                 ACALL DELAY
01D9 31DC            242                 ACALL DELAY
01DB 22              243                 RET
                     244     
01DC                 245     DELAY:
01DC 7FFF            246                 MOV R7, #255
01DE 7EFF            247     D1:         MOV R6, #255
01E0 DEFE            248     D2:         DJNZ R6, D2
01E2 DFFA            249                 DJNZ R7, D1
01E4 22              250                 RET
                     251     
01E5                 252     INT0_ISR:
01E5 7D01            253                             MOV R5, #1
01E7 D225            254                 SETB 25H
01E9 C289            255                 CLR IE0
01EB 32              256                 RETI
01EC                 257     INT1_ISR:
01EC 7D02            258                             MOV R5, #2
01EE D225            259                 SETB 25H
01F0 C28B            260                 CLR IE1
01F2 32              261                 RETI
                     262     ; --------------------------------------------
                     263     ; 簡單蜂鳴器警報：播放固定頻率三次
                     264     ; --------------------------------------------
  0050               265     NOTE_FREQ   EQU 50H
  0060               266     FREQ_TEMP   EQU 60H
01F3                 267     MUSIC_DELAY_SHORT:
01F3 7F14            268                 MOV R7, #20
01F5 7D14            269     D1_SHORT:   MOV R5, #20
01F7 DDFE            270     D2_SHORT:   DJNZ R5, D2_SHORT
01F9 DFFA            271                 DJNZ R7, D1_SHORT
01FB 22              272                 RET
01FC                 273     PLAY_ALERT:
01FC 7F03            274                 MOV R7, #3            ; 播放 3 次警報音
01FE                 275     ALERT_LOOP:
01FE 7580F0          276                             MOV P0, #11110000B
0201 31DC            277                             ACALL DELAY
0203 7E64            278                 MOV R6, #100          ; 頻率（可調）
0205                 279     FREQ_LOOP_ALERT:
0205 8E60            280                 MOV FREQ_TEMP, R6
0207 B2A6            281                 CPL P2.6              ; 翻轉蜂鳴器腳位
0209 31F3            282                             ACALL MUSIC_DELAY_SHORT
020B AE60            283                 MOV R6, FREQ_TEMP
020D DEF6            284                 DJNZ R6, FREQ_LOOP_ALERT
                     285     
                     286                 ; 播放完一聲，暫停一下
020F 75800F          287                             MOV P0, #00001111B
0212 31DC            288                             ACALL DELAY           ; 可調整延遲長短
0214 DFE8            289                 DJNZ R7, ALERT_LOOP
0216 22              290                 RET
                     291                             
                     292                             END
A51 MACRO ASSEMBLER  TEST                                                                 06/13/2025 11:03:31 PAGE     6

SYMBOL TABLE LISTING
------ ----- -------


N A M E                T Y P E  V A L U E   ATTRIBUTES

AF_CHECK. . . . . . .  C ADDR   01CDH   A   
ALERT_LOOP. . . . . .  C ADDR   01FEH   A   
CHECK_PASSWORD. . . .  C ADDR   012EH   A   
CHK_LOOP. . . . . . .  C ADDR   0133H   A   
CLEAR_USERIN. . . . .  C ADDR   0173H   A   
CLR_LOOP. . . . . . .  C ADDR   0177H   A   
CORRECT . . . . . . .  C ADDR   0145H   A   
D1. . . . . . . . . .  C ADDR   01DEH   A   
D1_SHORT. . . . . . .  C ADDR   01F5H   A   
D2. . . . . . . . . .  C ADDR   01E0H   A   
D2_SHORT. . . . . . .  C ADDR   01F7H   A   
DELAY . . . . . . . .  C ADDR   01DCH   A   
DELAY_2S. . . . . . .  C ADDR   01D3H   A   
DONE_NEXT . . . . . .  C ADDR   01D2H   A   
DONE_PRINT. . . . . .  C ADDR   01A0H   A   
EA. . . . . . . . . .  B ADDR   00A8H.7 A   
EN. . . . . . . . . .  B ADDR   0090H.7 A   
EX0 . . . . . . . . .  B ADDR   00A8H.0 A   
EX1 . . . . . . . . .  B ADDR   00A8H.2 A   
FREQ_LOOP_ALERT . . .  C ADDR   0205H   A   
FREQ_TEMP . . . . . .  N NUMB   0060H   A   
HANDLE_ISR. . . . . .  C ADDR   00EBH   A   
HANDLE_NORMAL_INPUT .  C ADDR   0103H   A   
HANDLE_RET. . . . . .  C ADDR   010FH   A   
IE0 . . . . . . . . .  B ADDR   0088H.1 A   
IE1 . . . . . . . . .  B ADDR   0088H.3 A   
INPUT_LOOP. . . . . .  C ADDR   00DDH   A   
INT0_ISR. . . . . . .  C ADDR   01E5H   A   
INT1_ISR. . . . . . .  C ADDR   01ECH   A   
IT0 . . . . . . . . .  B ADDR   0088H.0 A   
IT1 . . . . . . . . .  B ADDR   0088H.2 A   
LCD_CLR . . . . . . .  C ADDR   0192H   A   
LCD_INIT. . . . . . .  C ADDR   017DH   A   
LCD_PRINT . . . . . .  C ADDR   0197H   A   
LCMD. . . . . . . . .  C ADDR   01B8H   A   
LDAT. . . . . . . . .  C ADDR   01ABH   A   
MAIN_LOOP . . . . . .  C ADDR   00D3H   A   
MSG_PREFIX. . . . . .  C ADDR   0035H   A   
MSG_SUFFIX. . . . . .  C ADDR   003DH   A   
MUSIC_DELAY_SHORT . .  C ADDR   01F3H   A   
NEXT_CHAR_ROUTINE . .  C ADDR   01C5H   A   
NOTE_FREQ . . . . . .  N NUMB   0050H   A   
P0. . . . . . . . . .  D ADDR   0080H   A   
P2. . . . . . . . . .  D ADDR   00A0H   A   
P3. . . . . . . . . .  D ADDR   00B0H   A   
PASSW . . . . . . . .  C ADDR   00A8H   A   
PLAY_ALERT. . . . . .  C ADDR   01FCH   A   
RESET_MSG . . . . . .  C ADDR   009AH   A   
RS. . . . . . . . . .  B ADDR   0090H.6 A   
RW. . . . . . . . . .  B ADDR   0090H.4 A   
SET_CURSOR_LINE1. . .  C ADDR   01A1H   A   
SET_CURSOR_LINE2. . .  C ADDR   01A6H   A   
SHOW_REMAINING_DIGITS  C ADDR   0119H   A   
START . . . . . . . .  C ADDR   00B3H   A   
TEXT1 . . . . . . . .  C ADDR   0016H   A   
TEXT2 . . . . . . . .  C ADDR   0025H   A   
TEXT_F. . . . . . . .  C ADDR   0051H   A   
TEXT_F1 . . . . . . .  C ADDR   007DH   A   
TEXT_F2 . . . . . . .  C ADDR   008CH   A   
TEXT_S. . . . . . . .  C ADDR   0045H   A   
A51 MACRO ASSEMBLER  TEST                                                                 06/13/2025 11:03:31 PAGE     7

TEXT_S1 . . . . . . .  C ADDR   0060H   A   
TEXT_S2 . . . . . . .  C ADDR   0071H   A   
USERIN. . . . . . . .  C ADDR   00AEH   A   
WRONG . . . . . . . .  C ADDR   015FH   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
